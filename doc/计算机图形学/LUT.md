# LUT 

理解 3D LUT png 文件

![](img_neutral_lut.png)

上面的 LUT 文件的像素尺寸为 512 * 512，可以看到有 8 * 8，64个小方格，这 64 个小方格的尺寸刚好又是 64 * 64 个像素组成。

64 个小方格的 Blue 都是固定的，从左往右，从上到下一次递增，如果我们的RGB分量用0-255表示，那么第一个格子的 Blue 分量是 0，第二个格子的 Blue 分量是 4，依次类推，最后一个格子的分量是 252。

对于每个小方格来说，水平方向上有 64 个像素，代表 Red 分量逐渐递增，垂直方向上有 64 个像素，代表 Green 分量逐渐递增。

那么我们输入的颜色值就可以在这上面找到一个对应的值。

比如我们输入的颜色值为 $r, g, b$ 三个浮点数，范围是 $[0, 1]$，首先我们需要找到是哪个一个小格子，直接用 b 分量乘以 64 可以得到小格子的下标。

$$index_b = b * 64$$

接下来，我们需要知道这个小格子左上角，相对于整个图的坐标。我们需要计算出小格子属于第几行，第几列。

$$row_b = ceil(\frac{index_b}{8})$$

$$col_b = index_b \mod 8$$

接下来，最后的坐标就是左上角的坐标加上红色分量和绿色分量的偏移结果。

$X = col_b * 64 + r * 64$

$Y = row_b * 64 + g * 64$

最后，我们读取这个坐标下的颜色值即可。

$$(R,G,B) = getColorAt(X, Y)$$

这样就完成了 $(r, g, b) \rightarrow (R, G, B)$ 的转换



